<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparison Game - Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:disabled {
            background-color: #cccccc;
        }
        input {
            padding: 6px;
            margin-right: 10px;
        }
        .player-choice {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
        .max { color: red; }
        .min { color: blue; }
        .mid { color: green; }
        .zero { color: orange; }
    </style>
</head>
<body>
    <h1>Comparison Game - Admin Panel</h1>
    
    <div class="section">
        <h2>Player Registration</h2>
        <div id="registered-players">
            <p>Waiting for players to register...</p>
            <table id="players-table">
                <thead>
                    <tr>
                        <th>Player Name</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="players-list">
                    <!-- Player list will be populated here -->
                </tbody>
            </table>
        </div>
        <button id="start-game-btn" disabled>Start Game</button>
        <p id="min-players-warning">At least 2 players needed to start (4 recommended)</p>
    </div>
    
    <div class="section" id="choices-section" style="display: none;">
        <h2>Player Choices</h2>
        <div id="choices-container">
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Choice</th>
                    </tr>
                </thead>
                <tbody id="choices-list">
                    <!-- Choices will be populated here -->
                </tbody>
            </table>
        </div>
        <button id="start-round-btn" disabled>Start Round</button>
        <p>Waiting for all players to make their choices...</p>
    </div>
    
    <div class="section" id="dice-section" style="display: none;">
        <h2>Dice Input</h2>
        <div id="dice-input-container">
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Dice 1</th>
                        <th>Dice 2</th>
                        <th>Dice 3</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="dice-list">
                    <!-- Dice inputs will be populated here -->
                </tbody>
            </table>
        </div>
        <button id="calculate-results-btn" disabled>Calculate Results</button>
    </div>
    
    <div class="section" id="results-section" style="display: none;">
        <h2>Game Results</h2>
        <div id="results-container">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Total</th>
                        <th>Points Earned</th>
                    </tr>
                </thead>
                <tbody id="results-list">
                    <!-- Results will be populated here -->
                </tbody>
            </table>
        </div>
        <button id="new-round-btn">Start New Round</button>
        <button id="end-game-btn">End Game</button>
    </div>

    <script>
        // Simulated data - in a real app, this would come from a server
        let players = [];
        let choices = {};
        let diceResults = {};
        let gameActive = false;
        
        // DOM elements
        const playersList = document.getElementById('players-list');
        const startGameBtn = document.getElementById('start-game-btn');
        const choicesList = document.getElementById('choices-list');
        const startRoundBtn = document.getElementById('start-round-btn');
        const diceList = document.getElementById('dice-list');
        const calculateResultsBtn = document.getElementById('calculate-results-btn');
        const resultsList = document.getElementById('results-list');
        const minPlayersWarning = document.getElementById('min-players-warning');
        
        // Sections
        const choicesSection = document.getElementById('choices-section');
        const diceSection = document.getElementById('dice-section');
        const resultsSection = document.getElementById('results-section');
        
        // Simulate player registration (in real app, this would be from websockets or polling)
        function simulatePlayerRegistration() {
            const samplePlayers = ['Alice', 'Bob', 'Charlie', 'Diana'];
            
            samplePlayers.forEach((player, index) => {
                setTimeout(() => {
                    addPlayer(player);
                    if (players.length >= 2) {
                        startGameBtn.disabled = false;
                        minPlayersWarning.style.color = 'green';
                        minPlayersWarning.textContent = `Ready to start with ${players.length} players!`;
                    }
                }, index * 1500);
            });
        }
        
        // Add a new player
        function addPlayer(name) {
            if (!players.includes(name)) {
                players.push(name);
                updatePlayersList();
            }
        }
        
        // Update players list display
        function updatePlayersList() {
            playersList.innerHTML = '';
            players.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player}</td>
                    <td>Registered</td>
                `;
                playersList.appendChild(row);
            });
        }
        
        // Start the game
        startGameBtn.addEventListener('click', () => {
            gameActive = true;
            startGameBtn.disabled = true;
            choicesSection.style.display = 'block';
            
            // Simulate players making choices
            simulatePlayerChoices();
        });
        
        // Simulate players making choices
        function simulatePlayerChoices() {
            const options = ['max', 'min', 'mid', 'zero'];
            
            players.forEach((player, index) => {
                setTimeout(() => {
                    const choice = options[Math.floor(Math.random() * options.length)];
                    choices[player] = choice;
                    updateChoicesList();
                    
                    // Check if all players have chosen
                    if (Object.keys(choices).length === players.length) {
                        startRoundBtn.disabled = false;
                    }
                }, index * 2000);
            });
        }
        
        // Update choices list display
        function updateChoicesList() {
            choicesList.innerHTML = '';
            players.forEach(player => {
                if (choices[player]) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${player}</td>
                        <td><span class="player-choice ${choices[player]}">${choices[player].toUpperCase()}</span></td>
                    `;
                    choicesList.appendChild(row);
                }
            });
        }
        
        // Start the round (dice input)
        startRoundBtn.addEventListener('click', () => {
            choicesSection.style.display = 'none';
            diceSection.style.display = 'block';
            setupDiceInputs();
        });
        
        // Set up dice inputs
        function setupDiceInputs() {
            diceList.innerHTML = '';
            
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player}</td>
                    <td><input type="number" min="1" max="6" class="dice-1" data-player="${player}"></td>
                    <td><input type="number" min="1" max="6" class="dice-2" data-player="${player}"></td>
                    <td><input type="number" min="1" max="6" class="dice-3" data-player="${player}"></td>
                    <td class="total" id="total-${player}">0</td>
                    <td><button class="confirm-dice" data-player="${player}">Confirm</button></td>
                `;
                diceList.appendChild(row);
                
                // Add event listeners to dice inputs
                const dice1 = row.querySelector('.dice-1');
                const dice2 = row.querySelector('.dice-2');
                const dice3 = row.querySelector('.dice-3');
                const confirmBtn = row.querySelector('.confirm-dice');
                const totalCell = row.querySelector('.total');
                
                // Calculate total when any dice changes
                [dice1, dice2, dice3].forEach(dice => {
                    dice.addEventListener('change', () => {
                        const total = parseInt(dice1.value || 0) + parseInt(dice2.value || 0) + parseInt(dice3.value || 0);
                        totalCell.textContent = total;
                    });
                });
                
                // Confirm dice values
                confirmBtn.addEventListener('click', () => {
                    const dice1Val = parseInt(dice1.value);
                    const dice2Val = parseInt(dice2.value);
                    const dice3Val = parseInt(dice3.value);
                    
                    if (isNaN(dice1Val) {
                        alert('Please enter a value for Dice 1');
                        return;
                    }
                    if (isNaN(dice2Val)) {
                        alert('Please enter a value for Dice 2');
                        return;
                    }
                    if (isNaN(dice3Val)) {
                        alert('Please enter a value for Dice 3');
                        return;
                    }
                    
                    diceResults[player] = {
                        dice: [dice1Val, dice2Val, dice3Val],
                        total: dice1Val + dice2Val + dice3Val
                    };
                    
                    // Disable inputs for this player
                    dice1.disabled = true;
                    dice2.disabled = true;
                    dice3.disabled = true;
                    confirmBtn.disabled = true;
                    
                    // Check if all players have confirmed
                    if (Object.keys(diceResults).length === players.length) {
                        calculateResultsBtn.disabled = false;
                    }
                });
            });
        }
        
        // Calculate results
        calculateResultsBtn.addEventListener('click', () => {
            diceSection.style.display = 'none';
            resultsSection.style.display = 'block';
            calculateResults();
        });
        
        // Calculate and display results
        function calculateResults() {
            // Create array of players with their totals
            const playerTotals = players.map(player => ({
                name: player,
                total: diceResults[player].total,
                choice: choices[player]
            }));
            
            // Sort by total (descending)
            playerTotals.sort((a, b) => b.total - a.total);
            
            // Assign ranks (handling ties)
            let currentRank = 1;
            for (let i = 0; i < playerTotals.length; i++) {
                if (i > 0 && playerTotals[i].total === playerTotals[i - 1].total) {
                    playerTotals[i].rank = playerTotals[i - 1].rank;
                } else {
                    playerTotals[i].rank = currentRank;
                }
                currentRank++;
            }
            
            // Calculate points based on ranks
            const rankGroups = {};
            playerTotals.forEach(player => {
                if (!rankGroups[player.rank]) {
                    rankGroups[player.rank] = [];
                }
                rankGroups[player.rank].push(player);
            });
            
            // Assign points based on rank groups
            const pointsMap = {
                1: 6,  // 1st place
                2: 3,  // 2nd place
                3: 1,  // 3rd place
                4: 0   // 4th place
            };
            
            Object.keys(rankGroups).forEach(rank => {
                const playersInRank = rankGroups[rank];
                const rankNum = parseInt(rank);
                
                // Calculate total points for this rank group
                let totalPoints = 0;
                let pointPositions = [];
                
                for (let i = 0; i < playersInRank.length; i++) {
                    const position = rankNum + i;
                    if (pointsMap[position] !== undefined) {
                        totalPoints += pointsMap[position];
                        pointPositions.push(position);
                    }
                }
                
                // Distribute points evenly among tied players
                const pointsPerPlayer = totalPoints / playersInRank.length;
                
                playersInRank.forEach(player => {
                    player.points = pointsPerPlayer;
                    player.pointPositions = pointPositions.join(', ');
                });
            });
            
            // Display results
            resultsList.innerHTML = '';
            playerTotals.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player.rank}</td>
                    <td>${player.name} (${player.choice})</td>
                    <td>${player.total}</td>
                    <td>${player.points.toFixed(1)} (from positions ${player.pointPositions})</td>
                `;
                resultsList.appendChild(row);
            });
        }
        
        // New round button
        document.getElementById('new-round-btn').addEventListener('click', () => {
            // Reset choices and dice results
            choices = {};
            diceResults = {};
            
            // Hide results, show choices section
            resultsSection.style.display = 'none';
            choicesSection.style.display = 'block';
            
            // Reset buttons
            startRoundBtn.disabled = true;
            calculateResultsBtn.disabled = true;
            
            // Simulate new choices
            simulatePlayerChoices();
        });
        
        // End game button
        document.getElementById('end-game-btn').addEventListener('click', () => {
            alert('Game ended. Returning to registration.');
            location.reload();
        });
        
        // Start simulation
        simulatePlayerRegistration();
    </script>
</body>
</html>
